
h2. Remote access to the def:bo_env

Connecting directly to the BoxOffice environment is not possible as it is at the customer site, typically behind a firewall.
Requiring the customer to change its firewall settings to allow inbound access is not an option.
Therefore, the BoxOffice will need to connect to a VPN proxy that is managed by Zenith. For redundancy, the BoxOffice appliance will connect to 2 comp:cloudcenter_vpnserver 's

The connection of the def:bo_env to def:cloudcenter is persistent.
There is a scheduled job on comp:bo_mgmt_appliance which checks ovpn connection is still open, if not connection will be re-created, if not possible a critical event will be created.
@todo 1 peter: check previous statement, prefer permanent connection (kds)


h2. some vpn & security principles

* each bo_env has unique ip address on each comp:cloudcenter_vpnserver (openvpn virtual address)
* this ip addr is known in comp:cloudcenter_db, this ip addr is called def:bo_private_ipaddr
* only 3 ports are enabled for now 
** http (port 80) for bo_portal access 
** rdpport for def:bo_recoverymachine
** ssh access to def:bo_mgmt_appliance

h3. https access to def:bo_portal
* the https://[bo_public_ipaddr/]//[guid of bo_env/]//[url in bpo_portal/] will be mapped onto /[def:bo_private_ipaddr/]:443/[url in bpo_portal/]   (authenticated proxy phase 2, authenticate against cloudcenter)

h3. RDP access to def:bo_recoverymachine
* the /[bo_public_ipaddr/]:/[a specific port nr/] will be mapped onto /[def:bo_private_ipaddr/]:[rdp tcp port] 
** for security this will only be allowed for a short time

h3. ssh access to def:bo_mgmt_appliance
* ssh access for def:master_operator into appliance for further troubleshooting

h2. process:

in a first version, no openvpn client will be required for bo_operators.
They can access a remote def:bo_env over RDP towards the def:bo_recoverymachine or over https to def:bo_portal

h3. normal support / troubleshooting for a remote def:bo_env

* def:bo_operator can access def:cloudcenter_gui over https
* def:bo_operator searches for def:bo_env he/she is interested in, on the detail page he will find a def:bo_portal link
* the def:bo_portal is accessible over def:cloudcenter_vpnserver (https reverse proxy installed on this server)
* @todo 1 despiegk: check   :  he will be automatically logged in into the def:bo_portal (phase2)
* on the def:bo_portal the operator can do 99% of the management tasks of a def:bo_env
* if KVM access or SSH access is required to a pmachine or vmachine the def:bo_recoverymachine will be used.

h3. def:bo_recoverymachine

* def:bo_operator searches for def:bo_env he/she is interested in, on the detail page he will find an action to get access to the required def:bo_recoverymachine in the appropriate def:bo_env
* this action results in a wizard which checks & audits the user's access rights to this portal
* a warning message is being shown
* the wizard will call a service on comp:cloudcenter_applicationserver to enable remote access
** an entry is created in comp:cloudcenter_db which marks the remote access
** the firewall on the comp:cloudcenter_vpnserver will be configured for portforwarding between a certain port & the port of the rdpserver of the def:bo_recoverymachine
*** only the source ip of the user accessing the wizard will be allowed.
* a preconfigured def:bo_recoverymachine is always active in a def:bo_env
* every 15 min on def:cloudcenter_vpnserver we remove all rules older than 2h (use info from out of comp:cloudcenter_db )

h3. what if def:bo_recoverymachine is not running?

* use def:bo_portal to start def:bo_recoverymachine  anc check status
* if that fails a def:master_operator will be required, they can login into comp:cloudcenter_vpnserver with openvpn and remote access the environment.

\\
\\
\\


h2. PHASE 2, IGNORE FOR NOW
The following services will be accessable for def:bo_operator
* ssh access to appliance and CPU/Storage nodes
* http access to the appliance to access the BoxOffice portal
* RDP access to the Virtual Machines running on the box office environment via the Q-helper and the SDK on the appliance

At the time of the BoxOffice registration with Zenith, the VPN IP addresses for each BoxOffice server have been registerd in the Zenith support database.
{note} 
We need to add this to the registration process with Zenith
{note}
Each BoxOffice environment is represented on a single IP address per VPN server.
* Thus if 2 VPN servers are available, the BoxOffice environment is accessible via these 2 IP addresses
Each node in the box office environment can be accessed through port mapping:
||Node||Service||port||
|Appliance|ssh|tbd|
|Appliance|http|tbd|
|Appliance|RDP|tbd|
|CPU/Storage Node 1|ssh|tbd|
|...|||
|CPU/Storage Node n|ssh|tbd|

Zenith can add buttons to the NOC operator screen to directly connect to these services, based on the IP and port information in the registration database.
